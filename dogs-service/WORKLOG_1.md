# Step 1 — Completed: Initialized SAM project scaffold in dogs_service.

Commands run (each command shown in its own code block with a short explanation).

```shell
cd /Users/savak/Projects/image_uploader
```
Change to the repository root so all project files and the new dogs_service folder are created in the correct location.

```shell
brew tap aws/tap && brew install aws-sam-cli
```
Install the AWS SAM CLI via Homebrew (if not already installed). SAM is required to scaffold, build, and run the serverless app locally.

```shell
sam init
```
Initialize a SAM project. Select `AWS Quick Start Templates` and `Hello World Example` as it seems like there are no proper template for python in Serverless API

```shell
cd dogs_service
```
Enter the newly created SAM project directory to continue project-specific setup.
```shell
python3 -m venv .venv
```
Create a simple virtual environment named `.venv` inside the `dogs_service` project. This keeps Python packages isolated per-project without introducing Poetry.

```shell
source .venv/bin/activate
```
Activate the virtual environment for the current shell session so subsequent `pip` installs go into `.venv`.

```shell
python3 -m pip install --upgrade pip setuptools wheel
```
Upgrade packaging tools inside the venv to ensure reliable installs and builds.

```shell
pip install boto3 pytest moto
```
Install development/test dependencies into the venv:
- `boto3` — only for local testing and mocks (Lambda runtime already provides boto3; avoid bundling it unless you need a specific version).
- `pytest` — unit test runner.
- `moto` — AWS mocking library for unit tests.

```shell
sam build --use-container
```
Build the SAM application (packages dependencies and prepares deployment artifacts). This uses the runtime container to ensure compatibility with the Lambda runtime. `--use-container` option is optional but highly recommended to use the real lambda runtime docker image instead of local python environment. 

```shell
sam local start-api
```
Run the API locally (requires Docker). This verifies the scaffolded endpoints are reachable and the Lambda handlers execute in a local emulation.

```shell
curl -v http://127.0.0.1:3000/hello
```
From a separate terminal verify that hello api works as expected.

```shell
sam local invoke HelloWorldFunction -e events/event.json
```
Run the simple autogenerated event for my sam project to verify my capability to invoke lambdea function directly bypassing api gateway. You can add `--debug` option to see more verbose logging

```shell
sam validate
```
This command allows me to validate that the sam template is correct.

```shell
sam local start-lambda
```
Now let's try to sart local lambda and check it in a few other ways.

```shell
aws lambda invoke --endpoint-url http://127.0.0.1:3001 --function-name HelloWorldFunction --payload file://events/event.json out.json --cli-binary-format raw-in-base64-out 
```
Now try to invoke lambda using `aws lambda invoke` api. Note `--cli-binary-format` specified, that suggests to aws cli v2 command to treat content as raw bytes in the requst body, otherwise you will observe unicode errors.

```shell
aws s3 mb s3://my-sam-artifacts-vklovan
```
Optional: This command creates a bucket to hold your artifacts. For personal use better to share the same bucket for multiple projects using object prefixes to share. Note that `sam deploy --guided` will ask you and can create one for you

```shell
sam deploy --guided
```
Launch the inteructive deployment of your api. After answering the question your CloudFormation stack will be deployed

```shell
curl https://sw4hfgtra5.execute-api.eu-west-1.amazonaws.com/Prod/hello/
```
Make a call to created stack to check that it works as expected. Url can be found in the outputs of stack.

```shell
export AWS_SAM_STACK_NAME=dogs-service
```
Now let's set `AWS_SAM_STACK_NAME` that is required to run API gateway integration tests.

```shell
python3 -m pytest tests -q
```
Now we are able to run both: unit and integration tests.

```shell
sam local generate-event apigateway aws-proxy --body "invalid" --stage "prod" --path "/test" --method "GET" --resource "test" > events/event2.json
```
Let's now try to generate a new event to verify our function once again.

```shell
sam local invoke HelloWorldFunction --event events/event2.json
```
You can now check that newly created event works as expected

```shell
sam remote test-event put HelloWorldFunction --stack-name dogs-service --name demo-event --file events/event.json
```
Let's try to move one of the test events to AWS to share

```shell
sam remote test-event list
```
Now if you call list of events you will see the created lambda event. It's also accessible in EventBridge custom schema registry. You can directly create those events from Lambda function and mark them as Shareable and they will be stored and then listed in this command. You can use those test events by using get method and store the event locally and use it for testing.

```shell
sam remote test-event get HelloWorldFunction --stack-name dogs-service --name demo-event --output-file events/event2.json
```
This is an example of method how we can get the shared lambda test event from Event Registry


```shell
sam remote invoke HelloWorldFunction --stack-name dogs-service --event '{"message": "hello!"}'
```
We can directly invoke hardcoded event 

```shell
sam remote invoke HelloWorldFunction --stack-name dogs-service --event-file events/event2.json
```
And this is an example of how we can invoke event from locally stored on the device

```shell
sam remote invoke HelloWorldFunction --stack-name dogs-service --parameter InvocationType="DryRun" --parameter LogType="None"
```
Here is an example of how we can configure boto3 parameters from directly invoking method

Then configured debugging by configuring AWS Toolkit. I had to go to Ctrl+Shift+P (Command Pallete) -> Settings (UI) and then enable CodeLense for SAM. Then went to template.yaml and pressed Add Debug Configuration right over Resource section of my file. Then I was able to press F5 and debug my python method.

```shell
sam sync --watch
```
Run this command and make changes in code to verify that it works.

```shell
sam delete --stack-name dogs-service
```